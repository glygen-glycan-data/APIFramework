<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Service</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>

<div id="compute">
    <textarea rows = "25" cols = "100" id="sequence">WURCS=2.0/4,7,6/[u2122h_2*NCC/3=O][a2122h-1b_1-5_2*NCC/3=O][a1122h-1b_1-5][a1122h-1a_1-5]/1-2-3-4-4-4-4/a4-b1_b4-c1_c3-d1_c6-e1_e3-f1_e6-g1</textarea><br>
    <form id="additional_para">
        <label>Notation: </label>
        <input type="radio" name="notation" value="snfg" checked><label>SNFG</label>
        <input type="radio" name="notation" value="cfg" ><label>CFG</label>

        <br>
        <label>Display: </label>
        <input type="radio" name="display" value="extended" checked><label>Extended</label>
        <input type="radio" name="display" value="normal" ><label>Normal</label>
        <input type="radio" name="display" value="compact" ><label>Compact</label>

        <br>
        <label>Reducing end: </label>
        <input type="radio" name="redend" value="y" checked><label>Show</label>
        <input type="radio" name="redend" value="n" ><label>Hide</label>

        <br>
        <label>Background: </label>
        <input type="radio" name="opaque" value="n" checked><label>White</label>
        <input type="radio" name="opaque" value="y" ><label>Opaque</label>

        <br>
        <label>Image format: </label>
        <input type="radio" name="image_format" value="png" checked><label>png</label>
        <input type="radio" name="image_format" value="jpg" ><label>jpg</label>
        <input type="radio" name="image_format" value="svg" ><label>svg</label>

        <br>
        <label>Scale: </label><input id="para_scale" type="number" value="1.0">

        <!---
        <br>
        <label>Option 2: </label>
        <input type="radio" name="" value="" checked><label></label>
        <input type="radio" name="" value="" ><label></label>
        <input type="radio" name="" value="" ><label></label>
        <input type="radio" name="" value="" ><label></label>
        --->


    </form>
    <button id="submit-sequence" onclick="compute()">Submit</button>
    <br><br><br>
    <div id="result"></div>
</div>

<h1>By sequence (real-time)</h1>
<p>WURCS=2.0/4,5,4/[a2122h-1b_1-5][a2112h-1b_1-5][a2122h-1b_1-5_2*NCC/3=O][a1221m-1a_1-5]/1-2-3-2-4/a4-b1_b3-c1_c3-d1_d3-e1</p>
<img src="./getimage?notation=snfg&display=compact&image_format=png&seq=WURCS=2.0/4,5,4/[a2122h-1b_1-5][a2112h-1b_1-5][a2122h-1b_1-5_2*NCC/3=O][a1221m-1a_1-5]/1-2-3-2-4/a4-b1_b3-c1_c3-d1_d3-e1">
<img src="./getimage?notation=snfg&display=extended&image_format=png&seq=WURCS=2.0/4,5,4/[a2122h-1b_1-5][a2112h-1b_1-5][a2122h-1b_1-5_2*NCC/3=O][a1221m-1a_1-5]/1-2-3-2-4/a4-b1_b3-c1_c3-d1_d3-e1"><br>


<h1>By sequence</h1>
<p>WURCS=2.0/4,5,4/[a2122h-1b_1-5][a2112h-1b_1-5][a2122h-1b_1-5_2*NCC/3=O][a1221m-1a_1-5]/1-2-3-2-4/a4-b1_b3-c1_c3-d1_d2-e1</p>
<img src="./getimage?notation=snfg&display=compact&image_format=png&seq=WURCS=2.0/4,5,4/[a2122h-1b_1-5][a2112h-1b_1-5][a2122h-1b_1-5_2*NCC/3=O][a1221m-1a_1-5]/1-2-3-2-4/a4-b1_b3-c1_c3-d1_d2-e1">
<img src="./getimage?notation=snfg&display=extended&image_format=png&seq=WURCS=2.0/4,5,4/[a2122h-1b_1-5][a2112h-1b_1-5][a2122h-1b_1-5_2*NCC/3=O][a1221m-1a_1-5]/1-2-3-2-4/a4-b1_b3-c1_c3-d1_d2-e1"><br>


<p>
RES<br>
1b:x-dglc-HEX-x:x<br>
2s:n-acetyl<br>
3b:b-dglc-HEX-1:5<br>
4s:n-acetyl<br>
5b:b-dman-HEX-1:5<br>
6b:a-dman-HEX-1:5<br>
7b:b-dglc-HEX-1:5<br>
8s:n-acetyl<br>
9b:a-dman-HEX-1:5<br>
10b:b-dglc-HEX-1:5<br>
11s:n-acetyl<br>
LIN<br>
1:1d(2+1)2n<br>
2:1o(4+1)3d<br>
3:3d(2+1)4n<br>
4:3o(4+1)5d<br>
5:5o(3+1)6d<br>
6:6o(2|4+1)7d<br>
7:7d(2+1)8n<br>
8:5o(6+1)9d<br>
9:9o(2|4+1)10d<br>
10:10d(2+1)11n<br>
</p>
<img src="./getimage?notation=snfg&display=compact&image_format=png&seq=RES%0A1b%3Ax-dglc-HEX-x%3Ax%0A2s%3An-acetyl%0A3b%3Ab-dglc-HEX-1%3A5%0A4s%3An-acetyl%0A5b%3Ab-dman-HEX-1%3A5%0A6b%3Aa-dman-HEX-1%3A5%0A7b%3Ab-dglc-HEX-1%3A5%0A8s%3An-acetyl%0A9b%3Aa-dman-HEX-1%3A5%0A10b%3Ab-dglc-HEX-1%3A5%0A11s%3An-acetyl%0ALIN%0A1%3A1d(2%2B1)2n%0A2%3A1o(4%2B1)3d%0A3%3A3d(2%2B1)4n%0A4%3A3o(4%2B1)5d%0A5%3A5o(3%2B1)6d%0A6%3A6o(2%7C4%2B1)7d%0A7%3A7d(2%2B1)8n%0A8%3A5o(6%2B1)9d%0A9%3A9o(2%7C4%2B1)10d%0A10%3A10d(2%2B1)11n">
<img src="./getimage?notation=snfg&display=extended&image_format=png&seq=RES%0A1b%3Ax-dglc-HEX-x%3Ax%0A2s%3An-acetyl%0A3b%3Ab-dglc-HEX-1%3A5%0A4s%3An-acetyl%0A5b%3Ab-dman-HEX-1%3A5%0A6b%3Aa-dman-HEX-1%3A5%0A7b%3Ab-dglc-HEX-1%3A5%0A8s%3An-acetyl%0A9b%3Aa-dman-HEX-1%3A5%0A10b%3Ab-dglc-HEX-1%3A5%0A11s%3An-acetyl%0ALIN%0A1%3A1d(2%2B1)2n%0A2%3A1o(4%2B1)3d%0A3%3A3d(2%2B1)4n%0A4%3A3o(4%2B1)5d%0A5%3A5o(3%2B1)6d%0A6%3A6o(2%7C4%2B1)7d%0A7%3A7d(2%2B1)8n%0A8%3A5o(6%2B1)9d%0A9%3A9o(2%7C4%2B1)10d%0A10%3A10d(2%2B1)11n"><br>



<h1>By accession</h1>
<img src="./image/snfg/compact/G00012MO.png">
<img src="./image/snfg/extended/G00012MO.png"><br>

<img src="./image/snfg/compact/G00014MO.png">
<img src="./image/snfg/extended/G00014MO.png"><br>

<img src="./image/snfg/compact/G00023MO.png">
<img src="./image/snfg/extended/G00023MO.png"><br>

<img src="./image/snfg/compact/G00062MO.png">
<img src="./image/snfg/extended/G00062MO.png"><br>

<h1>By sequence hash</h1>
<img src="./image/snfg/compact/75130cf40b7338f08e50554e1db46f41.png">
<img src="./image/snfg/extended/75130cf40b7338f08e50554e1db46f41.png"><br>

<img src="./image/snfg/compact/96b63a6edd0299118edb4fddfe25d7a3.png">
<img src="./image/snfg/extended/96b63a6edd0299118edb4fddfe25d7a3.png"><br>


<h1>Error</h1>
<img src="./image/cfg/compact/G00012MO.png">
<img src="./image/snfg/whatever/G00012MO.png">
<img src="./image/snfg/compact/G12345XX.png">
<img src="./image/snfg/extended/533dfa2bs56c163682fcdc7c15c1a194.png">
<img src="./getimage?notation=snfg&display=extended&image_format=png&seq=RES%0A1b%3Ax-dglc-HEX-x%3Ax%0A2s%3An-asetyl%0A3b%3Ab-dglc-HEX-1%3A5%0A4s%3An-acetyl%0A5b%3Ab-dman-HEX-1%3A5%0A6b%3Aa-dman-HEX-1%3A5%0A7b%3Ab-dglc-HEX-1%3A5%0A8s%3An-acetyl%0A9b%3Aa-dman-HEX-1%3A5%0A10b%3Ab-dglc-HEX-1%3A5%0A11s%3An-acetyl%0ALIN%0A1%3A1d(2%2B1)2n%0A2%3A1o(4%2B1)3d%0A3%3A3d(2%2B1)4n%0A4%3A3o(4%2B1)5d%0A5%3A5o(3%2B1)6d%0A6%3A6o(2%7C4%2B1)7d%0A7%3A7d(2%2B1)8n%0A8%3A5o(6%2B1)9d%0A9%3A9o(2%7C4%2B1)10d%0A10%3A10d(2%2B1)11n"><br>




<script>
    function updateServerStatus(){
        jQuery.getJSON("./queue").then(function (d) {
            const s_p = " motifs are waiting for aligning";
            var s_s = "1 motif is waiting for aligning";
            var s_empty = "Empty load on the server";
            var s = "";

            if (d == 0) {
                s = s_empty;
            }
            else if (d == 1) {
                s = s_s;
            }
            else {
                s = d + s_p;
            }
            document.getElementById("server-status").innerHTML = s;
        })
    }
    // updateServerStatus();

    function space(){
        var space = document.createElement("span");
        space.innerHTML = '&nbsp&nbsp';
        return space
    }

    var list_id = "";
    var query_counter = 0;
    var this_result = {};
    var para = {}
    function compute(){
        para = {"developer_email":"interactive"};
        para["seq"] = document.getElementById("sequence").value;

        var formEle = document.getElementById("additional_para");
        for (var ele of formEle.childNodes){

            if (ele.tagName != "INPUT"){
                continue
            }

            if (ele.type != "radio"){
                continue
            }

            if (ele.checked){
                para[ele.name] = ele.value;
            }

        }

        para.scale = parseFloat(document.getElementById("para_scale").value)


        var requestURL = "./submit?tasks="+encodeURIComponent(JSON.stringify([para]));

        jQuery.getJSON(requestURL).then(function (d) {
            d = d[0]
            list_id = d.id;
            query_counter = 0;
            //document.getElementById("result").innerHTML = "<a href='./retrieve?list_id="+d.list_id+"'>"+"Click me to see result"+"</a>";
            document.getElementById("result").innerHTML = "Submitted successfully";
            get_results();
        })
    }

    function get_results() {
        var requestURL = "./retrieve?list_ids=" + JSON.stringify([list_id]);
        query_counter += 1;
        jQuery.getJSON(requestURL).then(function (d) {
            d = d[0];
            if (d.finished){
                this_result = d;
                display_results();
            }else{
                setTimeout(get_results, 1000);
                document.getElementById("result").innerHTML = "Checked for the "+query_counter+" times, haven't completed yet";
            }
        })
    }

    function display_results() {
        var d = this_result;


        var runtime = d["stat"]["runtime"];
        var rterror = d["error"];

        if (rterror.length > 0){
            document.getElementById("result").innerHTML = "ERROR: "+rterror;
        }


        document.getElementById("result").innerHTML = "Alignment Calculation Time: " + runtime.toFixed(5);

        var original_task = d["task"];
        var result_hash = d["result"];


        var base_image_static_url = "./image/hash/"
        var the_image_url = base_image_static_url + result_hash + "." + d.task.image_format;

        document.getElementById("result").innerHTML += "<br><a href='"+the_image_url+"' target=\"_blank\">Open me in new tab</a><br>"

        var something = "<div style='background: lightgrey; padding: 20px; display: inline-block'>"
        if (d.task.image_format == "svg"){
            something += "<object data='"+the_image_url+"' type='image/svg+xml' style='width: 100%'></object>"
        }
        else {
            something += "<img src='"+the_image_url+"'>"
        }
        something += "</div>";

        document.getElementById("result").innerHTML += something
    }



</script>

</body>
</html>